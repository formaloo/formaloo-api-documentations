<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>Formaloo API Documentation</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon-16x16.png">
    <link rel="manifest" href="assets/site.webmanifest">

    <script src="https://unpkg.com/@stoplight/elements@8/web-components.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@stoplight/elements@8/styles.min.css" />
  </head>
  <body>
    <input
      type="text"
      placeholder="Search in endpoints"
      name="search"
      id="search"
      style="background-color: white; padding: 5px; border-radius: 5px"
    />
    <elements-api
      apiDescriptionUrl="/openapi-v3.0.yaml"
      logo="/assets/logo.svg"
      router="hash"
      layout="sidebar"
      hideTryIt="false"
    />

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('search');
        let debounceTimer;
        
        searchInput.addEventListener('keyup', function() {
          clearTimeout(debounceTimer);
          const term = this.value.toLowerCase().trim();
          
          debounceTimer = setTimeout(function() {
            // Search in sidebar navigation items
            const sidebarItems = document.querySelectorAll('.sl-my-3 > *, [role="menuitem"], .sl-flex.sl-flex-col > *');
            sidebarItems.forEach(function(item) {
              const text = item.textContent.toLowerCase();
              if (!term || text.includes(term)) {
                item.style.display = '';
              } else {
                item.style.display = 'none';
              }
            });
            
            // Search in endpoint sections
            const endpointSections = document.querySelectorAll('[data-testid^="operation-"], .HttpOperation, article');
            endpointSections.forEach(function(section) {
              const text = section.textContent.toLowerCase();
              const path = section.querySelector('[data-testid="http-operation-path"]');
              const method = section.querySelector('[data-testid="http-operation-method"]');
              const pathText = path ? path.textContent.toLowerCase() : '';
              const methodText = method ? method.textContent.toLowerCase() : '';
              
              if (!term || text.includes(term) || pathText.includes(term) || methodText.includes(term)) {
                section.style.display = '';
                section.style.opacity = '1';
              } else {
                section.style.display = 'none';
                section.style.opacity = '0.3';
              }
            });
            
            // Expand/show parent sections that contain matching items
            if (term) {
              const visibleItems = document.querySelectorAll('.sl-my-3 > *[style*="display: block"], .sl-my-3 > *:not([style*="display: none"])');
              visibleItems.forEach(function(item) {
                let parent = item.parentElement;
                while (parent && parent !== document.body) {
                  if (parent.style.display === 'none') {
                    parent.style.display = '';
                  }
                  parent = parent.parentElement;
                }
              });
            }
          }, 300);
        });
        
        // Clear search on ESC
        searchInput.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
            this.value = '';
            this.dispatchEvent(new Event('keyup'));
          }
        });
      });
    </script>
  </body>
</html>
